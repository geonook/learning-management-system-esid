# ğŸ“‹ Primary School LMS - é …ç›®ç‹€æ³è¨˜éŒ„

> **æœ€å¾Œæ›´æ–°**: 2025-08-15  
> **ç‰ˆæœ¬**: v1.2.0 (Phase 3A-1 å®Œæˆ)  
> **ç‹€æ…‹**: ğŸŸ¢ é–‹ç™¼é€²è¡Œä¸­ | ğŸ“‹ æ–‡ä»¶å·²åŒæ­¥æ›´æ–°  

---

## ğŸ“Š é …ç›®ç¾ç‹€ (Current Status)

### ğŸ¯ é–‹ç™¼éšæ®µ
- **Phase 2C**: âœ… å®Œæˆ (Assessment Title ç®¡ç†ã€Student Course ç®¡ç†ã€Real-time é€šçŸ¥)
- **Phase 3A-1**: âœ… å®Œæˆ (Analytics åŸºç¤æ¶æ§‹ã€æ ¸å¿ƒè¨ˆç®—å¼•æ“)
- **Phase 3A-2**: ğŸ”„ æº–å‚™é–‹å§‹ (å­¸ç¿’è»Œè·¡åˆ†æã€æ€§èƒ½é æ¸¬)

### ğŸ’» æŠ€è¡“æ£§
- **å‰ç«¯**: Next.js 14 (App Router) + TypeScript + Tailwind + shadcn/ui
- **å¾Œç«¯**: Supabase (PostgreSQL + Auth + Storage + Edge Functions)
- **éƒ¨ç½²**: Zeabur (å‰ç«¯) + Supabase Cloud (å¾Œç«¯)
- **æ¸¬è©¦**: Vitest (å–®å…ƒæ¸¬è©¦) + Playwright (E2Eæ¸¬è©¦)

### ğŸ« æ•™è‚²æ¶æ§‹
- **å­¸åˆ¶**: å°å­¸ G1-G6 (Grade 1-6)
- **èª²ç¨‹é«”ç³»**: ELA ä¸‰è»Œåˆ¶ (LT English + IT English + KCFS)
- **æ ¡å€ç®¡ç†**: Local Campus / International Campus
- **è§’è‰²æ¬Šé™**: Admin / Head Teacher / Teacher (LT/IT/KCFS)

---

## âœ… å·²å®ŒæˆåŠŸèƒ½ (Completed Features)

### ğŸ—ï¸ Phase 2C - ç®¡ç†åŠŸèƒ½å¢å¼·
- [x] **Assessment Title ç®¡ç†ç³»çµ±**
  - Head Teacher å¯è‡ªå®šç¾©è©•é‡é¡¯ç¤ºåç¨±
  - å±¤ç´šå„ªå…ˆåºï¼šClass > GradeÃ—Campus > Default
  - æ¬Šé™æ§åˆ¶ï¼šåƒ… admin å’Œ head è§’è‰²å¯å­˜å–
  
- [x] **Student Course ç®¡ç†åŠŸèƒ½**
  - å­¸ç”Ÿèª²ç¨‹é—œè¯æŸ¥è©¢ (`getStudentsWithCourses`)
  - æ‰¹é‡æ“ä½œï¼š`bulkAssignStudentsToClass`, `bulkRemoveStudentsFromClass`
  - çµ±è¨ˆæ•¸æ“šï¼šå„å¹´æ®µèª²ç¨‹åˆ†ä½ˆçµ±è¨ˆ
  - å­¸ç”Ÿå‡ç´šï¼šæ‰¹é‡å¹´æ®µå‡ç´šåŠŸèƒ½

- [x] **Real-time é€šçŸ¥ç³»çµ±**
  - æ™ºèƒ½ç›£æ§ï¼šè‡ªå‹•åˆ†æç³»çµ±ç‹€æ…‹ç”Ÿæˆé€šçŸ¥
  - åˆ†é¡ç³»çµ±ï¼š8ç¨®é€šçŸ¥é¡å‹ (exam_overdue, low_completion ç­‰)
  - å„ªå…ˆç´šç®¡ç†ï¼šurgent > high > medium > low
  - è§’è‰²ç¯©é¸ï¼šä¾æ¬Šé™è‡ªå‹•éæ¿¾é€šçŸ¥

### ğŸ§® Phase 3A-1 - Analytics åŸºç¤æ¶æ§‹
- [x] **æ ¸å¿ƒ Analytics å¼•æ“**
  - å®Œæ•´å‹åˆ¥ç³»çµ±ï¼š40+ TypeScript ä»‹é¢
  - çµ±è¨ˆè¨ˆç®—ï¼šå¹³å‡å€¼ã€ä¸­ä½æ•¸ã€æ¨™æº–å·®ã€è¶¨å‹¢åˆ†æ
  - æˆç¸¾è¨ˆç®—ï¼šFormative/Summative/Semester æ•´åˆ
  - å¿«å–æ©Ÿåˆ¶ï¼šTTL è‡ªå‹•å¤±æ•ˆ + æ•ˆèƒ½æœ€ä½³åŒ–

- [x] **è³‡æ–™è™•ç†å±¤**
  - Query Builderï¼šå‹•æ…‹æŸ¥è©¢å»ºæ§‹
  - é¢¨éšªè©•ä¼°ï¼šå­¸ç¿’è¡¨ç¾é è­¦ç³»çµ±
  - è§’è‰²éæ¿¾ï¼šRLS æ”¿ç­–å®Œå…¨éµå¾ª
  - éŒ¯èª¤è™•ç†ï¼šå®Œæ•´ä¾‹å¤–è™•ç†æ©Ÿåˆ¶

### ğŸ”§ ç³»çµ±ä¿®å¾© (Recent Fixes)
- [x] **Header ç”¨æˆ¶é¡¯ç¤ºä¿®å¾©**
  - ç§»é™¤ç¡¬ç·¨ç¢¼ "John Teacher" é¡¯ç¤º
  - å‰µå»º `useCurrentUser` hook å‹•æ…‹æŠ“å–ç”¨æˆ¶è³‡æ–™
  - å³æ™‚é¡¯ç¤ºï¼šå§“åã€Emailã€é ­åƒç¸®å¯«

- [x] **Course é¸æ“‡åŠŸèƒ½ä¿®å¾©**
  - ä¿®å¾©æ¬Šé™éæ¿¾ï¼šæ•™å¸«åªèƒ½çœ‹åˆ°è‡ªå·±çš„èª²ç¨‹
  - æ­£ç¢ºè³‡æ–™é€£æ¥ï¼šclass è³‡æ–™ + å­¸ç”Ÿäººæ•¸çµ±è¨ˆ
  - è§’è‰²å€åˆ†ï¼šadmin/head/teacher ä¸åŒæ¬Šé™ç¯„åœ

- [x] **æ¸¬è©¦ç’°å¢ƒå»ºç½®**
  - G1-G6 å®Œæ•´æ¸¬è©¦è³‡æ–™ï¼šç”¨æˆ¶ã€ç­ç´šã€èª²ç¨‹ã€å­¸ç”Ÿ
  - å¤šè§’è‰²æ¸¬è©¦å¸³è™Ÿï¼š12 å€‹ Head Teacher + 18 å€‹ç§‘ç›®æ•™å¸«
  - ç¯„ä¾‹æˆç¸¾è³‡æ–™ï¼šæ”¯æ´ Analytics åŠŸèƒ½æ¸¬è©¦

---

## ğŸ“ å¾…è¾¦äº‹é … (Todo Tasks)

### ğŸ”„ ç•¶å‰é€²è¡Œä¸­
- [ ] **å‰µå»ºé …ç›®ç‹€æ³è¨˜éŒ„æ–‡ä»¶** (æœ¬æ–‡ä»¶) - `in_progress`

### â³ å¾…é–‹å§‹ä»»å‹™

#### Phase 3A-1 å‰©é¤˜å·¥ä½œ
- [ ] **å»ºç«‹åˆ†æå°ˆç”¨çš„è³‡æ–™åº«è¦–åœ–èˆ‡ç´¢å¼•**
  - å­¸ç”Ÿæˆç¸¾èšåˆè¦–åœ–
  - ç­ç´šçµ±è¨ˆè¦–åœ–  
  - æ•™å¸«ç¸¾æ•ˆè¦–åœ–
  - æ•ˆèƒ½æœ€ä½³åŒ–ç´¢å¼•

#### Phase 3A-2 - å­¸ç¿’åˆ†æ
- [ ] **å­¸ç¿’è»Œè·¡åˆ†æç³»çµ±**
  - å€‹åˆ¥å­¸ç”Ÿå­¸ç¿’æ›²ç·š
  - å¼±é»è­˜åˆ¥èˆ‡æ”¹é€²å»ºè­°
  - å­¸ç¿’æ¨¡å¼åˆ†æ
  - å­¸ç¿’æ•ˆæœé æ¸¬æ¨¡å‹

- [ ] **å€‹äººåŒ–å­¸ç¿’å ±å‘Š**
  - å­¸ç”Ÿå€‹äººæˆç¸¾å ±å‘Š
  - å®¶é•·å‹å–„çš„å¯è¦–åŒ–åœ–è¡¨
  - å­¸ç¿’å»ºè­°èˆ‡ç›®æ¨™è¨­å®š
  - PDF å ±å‘Šç”¢ç”ŸåŠŸèƒ½

#### Phase 3A-3 - æ•™å­¸åˆ†æ
- [ ] **æ•™å¸«æ•ˆèƒ½è©•ä¼°ç³»çµ±**
  - æ•™å­¸æ•ˆæœæŒ‡æ¨™
  - ç­ç´šæ¯”è¼ƒåˆ†æ
  - èª²ç¨‹é›£åº¦èª¿æ•´å»ºè­°
  - æ•™å­¸è³‡æºæ¨è–¦

- [ ] **ç­ç´šç®¡ç†åˆ†æå·¥å…·**
  - ç­ç´šæ•´é«”è¡¨ç¾åˆ†æ
  - åŒå¹´æ®µæ©«å‘æ¯”è¼ƒ
  - è©•é‡åˆ†æèˆ‡æª¢è¨
  - æ•™å­¸ç­–ç•¥æœ€ä½³åŒ–

#### Phase 3A-4 - ç®¡ç†åˆ†æ
- [ ] **å­¸æ ¡ç´š Analytics Dashboard**
  - å…¨æ ¡ç¸¾æ•ˆç¸½è¦½
  - å¹´æ®µæ¯”è¼ƒåˆ†æ
  - èª²ç¨‹æ•ˆæœè©•ä¼°
  - è³‡æºé…ç½®æœ€ä½³åŒ–

- [ ] **è¶¨å‹¢åˆ†æèˆ‡é æ¸¬ç³»çµ±**
  - é•·æœŸè¶¨å‹¢åˆ†æ
  - é æ¸¬æ€§åˆ†æå ±å‘Š
  - æ±ºç­–æ”¯æ´ç³»çµ±
  - KPI è¿½è¹¤èˆ‡è­¦ç¤º

### ğŸ§ª æ¸¬è©¦èˆ‡å“è³ªä¿è­‰
- [ ] **äººå·¥æ¸¬è©¦ï¼šæ ¸å¿ƒåŠŸèƒ½æµç¨‹é©—è­‰**
  - ç™»å…¥æµç¨‹ + è§’è‰²æ¬Šé™
  - æˆç¸¾è¼¸å…¥ + è¨ˆç®—é©—è­‰
  - Course é¸æ“‡ + å­¸ç”Ÿç®¡ç†
  - CSV åŒ¯å…¥ç³»çµ±

- [ ] **äººå·¥æ¸¬è©¦ï¼šAnalytics ç³»çµ±åŠŸèƒ½é©—è­‰**
  - çµ±è¨ˆè¨ˆç®—æ­£ç¢ºæ€§
  - è¦–è¦ºåŒ–åœ–è¡¨å‘ˆç¾
  - å³æ™‚è³‡æ–™æ›´æ–°
  - æ•ˆèƒ½å£“åŠ›æ¸¬è©¦

### ğŸ”§ ç³»çµ±æœ€ä½³åŒ–
- [ ] **æ•ˆèƒ½æœ€ä½³åŒ–**
  - è³‡æ–™åº«æŸ¥è©¢æœ€ä½³åŒ–
  - å‰ç«¯ bundle å¤§å°æ¸›å°‘
  - åœ–ç‰‡ + éœæ…‹è³‡æºå¿«å–
  - API å›æ‡‰æ™‚é–“å„ªåŒ–

- [ ] **å®‰å…¨æ€§å¼·åŒ–**
  - RLS æ”¿ç­–å®Œæ•´æ€§æª¢æŸ¥
  - SQL Injection é˜²è­·é©—è­‰
  - ç”¨æˆ¶è¼¸å…¥é©—è­‰å¼·åŒ–
  - å­˜å–æ—¥èªŒèˆ‡ç›£æ§

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹ (Architecture)

### ğŸ“ æ ¸å¿ƒæ¨¡çµ„æ¶æ§‹
```
lib/
â”œâ”€â”€ analytics/          # ğŸ§  Phase 3A-1 âœ… Analytics æ ¸å¿ƒå¼•æ“ 
â”‚   â”œâ”€â”€ core.ts         # çµ±è¨ˆè¨ˆç®— + å¿«å–æ©Ÿåˆ¶ + é¢¨éšªè©•ä¼°
â”‚   â”œâ”€â”€ types.ts        # 40+ TypeScript å‹åˆ¥å®šç¾© (å®Œæ•´)
â”‚   â”œâ”€â”€ utils.ts        # è³‡æ–™è™•ç†å·¥å…·å‡½å¼ + æˆç¸¾æ•´åˆ
â”‚   â”œâ”€â”€ queries.ts      # å‹•æ…‹æŸ¥è©¢å»ºæ§‹å™¨ + RLS éæ¿¾
â”‚   â””â”€â”€ index.ts        # çµ±ä¸€åŒ¯å‡ºä»‹é¢
â”œâ”€â”€ api/                # å‰ç«¯è³‡æ–™å±¤ (å·²å„ªåŒ–)
â”‚   â”œâ”€â”€ scores.ts       # æˆç¸¾ç®¡ç† API âœ… (æ¬Šé™ä¿®å¾©å®Œæˆ)
â”‚   â”œâ”€â”€ analytics.ts    # Analytics API âœ… (æ–°åŠŸèƒ½)
â”‚   â”œâ”€â”€ notifications.ts # å³æ™‚é€šçŸ¥ API âœ… (æ™ºèƒ½åŒ–)
â”‚   â”œâ”€â”€ assessment-titles.ts # è©•é‡æ¨™é¡Œç®¡ç† âœ…
â”‚   â”œâ”€â”€ students.ts     # å­¸ç”Ÿèª²ç¨‹ç®¡ç† âœ…
â”‚   â””â”€â”€ dashboard.ts    # å„€è¡¨æ¿è³‡æ–™ âœ…
â”œâ”€â”€ grade/              # ğŸ§® æˆç¸¾è¨ˆç®—æ ¸å¿ƒ (ç©©å®š)
â”‚   â”œâ”€â”€ calculations.ts # ç´”å‡½å¼æˆç¸¾è¨ˆç®—
â”‚   â”œâ”€â”€ types.ts        # Grade ç›¸é—œå‹åˆ¥
â”‚   â””â”€â”€ display-names.ts # é¡¯ç¤ºåç¨±è™•ç†
â”œâ”€â”€ hooks/              # React Hooks (æ–°å¢)
â”‚   â””â”€â”€ use-current-user.ts # ç”¨æˆ¶è³‡æ–™ Hook âœ…
â””â”€â”€ supabase/          # Supabase æ•´åˆå±¤ (æˆç†Ÿ)
    â”œâ”€â”€ client.ts       # Client-side é€£æ¥
    â”œâ”€â”€ server.ts       # Server-side é€£æ¥
    â””â”€â”€ auth-context.tsx # èªè­‰ç‹€æ…‹ç®¡ç†
```

### ğŸ” æ¬Šé™æ¶æ§‹ (RLS)
- **Admin**: å…¨åŸŸå­˜å–æ¬Šé™
- **Head Teacher**: å¹´æ®µ Ã— æ ¡å€ç¯„åœæ¬Šé™
- **Teacher (LT/IT/KCFS)**: åƒ…è‡ªå·±ä»»èª²ç­ç´šæ¬Šé™
- **Student**: å€‹äººè³‡æ–™å­˜å–æ¬Šé™

### ğŸ“Š è³‡æ–™åº«æ¶æ§‹
- **ç”¨æˆ¶ç®¡ç†**: users (role, teacher_type, grade, track)
- **ç­ç´šæ¶æ§‹**: classes (grade 1-6, track local/international, level E1/E2/E3)
- **èª²ç¨‹é«”ç³»**: courses (LT/IT/KCFS for each class)
- **å­¸ç”Ÿè³‡æ–™**: students + student_courses (å¤šå°å¤šé—œä¿‚)
- **æˆç¸¾ç³»çµ±**: scores (FA1-8, SA1-4, FINAL) + exams
- **é€šçŸ¥ç³»çµ±**: notifications (å³æ™‚ç‹€æ…‹æ›´æ–°)

---

## ğŸ§ª æ¸¬è©¦ç’°å¢ƒ (Testing Environment)

### ğŸ‘¥ å¯ç”¨æ¸¬è©¦å¸³è™Ÿ
> **å¯†ç¢¼è¦å‰‡**: ä½¿ç”¨ç”¨æˆ¶å (å»æ‰ @esid.edu)

#### ğŸ”’ ç³»çµ±ç®¡ç†å“¡
- `admin@esid.edu` - System Administrator (å…¨åŸŸæ¬Šé™)

#### ğŸ« å¹´æ®µä¸»ä»» (Head Teachers)
- `head.g1.local@esid.edu` - Grade 1 Local Campus Head
- `head.g1.intl@esid.edu` - Grade 1 International Campus Head
- `head.g2.local@esid.edu` - Grade 2 Local Campus Head
- `head.g2.intl@esid.edu` - Grade 2 International Campus Head
- ... (G1-G6 Ã— Local/International = 12 positions)

#### ğŸ‘¨â€ğŸ« ç§‘ç›®æ•™å¸« (Subject Teachers)
- `lt.g1@esid.edu` - Grade 1 LT Teacher (æœ¬åœ°è‹±èª)
- `it.g1@esid.edu` - Grade 1 IT Teacher (åœ‹éš›è‹±èª)  
- `kcfs.g1@esid.edu` - Grade 1 KCFS Teacher (æœªä¾†æŠ€èƒ½)
- ... (G1-G6 Ã— 3 subjects = 18 teachers)

### ğŸ« æ¸¬è©¦è³‡æ–™æ¦‚æ³
- **ç­ç´šæ•¸**: 24 å€‹ç­ç´š (G1-G6 Ã— å„ 4 ç­)
- **å­¸ç”Ÿæ•¸**: ç´„ 480 åå­¸ç”Ÿ (æ¯ç­ 20 äºº)
- **èª²ç¨‹æ•¸**: 72 é–€èª²ç¨‹ (æ¯ç­ 3 é–€ï¼šLT + IT + KCFS)
- **ç¯„ä¾‹æˆç¸¾**: å·²å»ºç«‹éƒ¨åˆ†æ¸¬è©¦æˆç¸¾è³‡æ–™

### ğŸ”— æ¸¬è©¦ç’°å¢ƒ URL
- **æœ¬åœ°é–‹ç™¼**: http://localhost:3000
- **Zeabur éƒ¨ç½²**: [å¾…æ›´æ–°]

---

## ğŸš€ ä¸‹ä¸€æ­¥è¨ˆåŠƒ (Next Steps)

### ğŸ“… çŸ­æœŸç›®æ¨™ (1-2 é€±)
1. **å®Œæˆ Phase 3A-1 å‰©é¤˜å·¥ä½œ**
   - å»ºç«‹è³‡æ–™åº«åˆ†æè¦–åœ–
   - æ•ˆèƒ½æœ€ä½³åŒ–èˆ‡ç´¢å¼•

2. **ç³»çµ±æ¸¬è©¦èˆ‡é©—è­‰**
   - å…¨é¢äººå·¥æ¸¬è©¦æ ¸å¿ƒåŠŸèƒ½
   - Analytics åŠŸèƒ½æ­£ç¢ºæ€§é©—è­‰
   - æ•ˆèƒ½èˆ‡å®‰å…¨æ€§æ¸¬è©¦

### ğŸ“… ä¸­æœŸç›®æ¨™ (2-4 é€±)  
1. **Phase 3A-2 é–‹ç™¼**
   - å­¸ç¿’è»Œè·¡åˆ†æç³»çµ±
   - å€‹äººåŒ–å­¸ç¿’å ±å‘Š

2. **ç”¨æˆ¶é«”é©—å„ªåŒ–**
   - UI/UX ç´°ç¯€æ”¹é€²
   - è¡Œå‹•ç«¯éŸ¿æ‡‰å¼å„ªåŒ–
   - è¼‰å…¥æ•ˆèƒ½æå‡

### ğŸ“… é•·æœŸç›®æ¨™ (1-2 æœˆ)
1. **Phase 3A-3 & 3A-4 é–‹ç™¼**
   - æ•™å¸«æ•ˆèƒ½è©•ä¼°ç³»çµ±
   - å­¸æ ¡ç´šç®¡ç†åˆ†æ

2. **ç”Ÿç”¢ç’°å¢ƒæº–å‚™**
   - å®Œæ•´éƒ¨ç½²æµç¨‹
   - ç›£æ§èˆ‡è­¦ç¤ºç³»çµ±
   - è³‡æ–™å‚™ä»½ç­–ç•¥

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ¨™ (Success Metrics)

### ğŸ¯ åŠŸèƒ½å®Œæ•´æ€§
- [x] ELA ä¸‰è»Œèª²ç¨‹æ¶æ§‹ 100% é‹ä½œ
- [x] RLS æ¬Šé™ç³»çµ± 100% æ­£ç¢º
- [x] æˆç¸¾è¨ˆç®—ç³»çµ± 100% æº–ç¢º  
- [ ] Analytics è¦–è¦ºåŒ– 100% å¯ç”¨
- [ ] å³æ™‚é€šçŸ¥ç³»çµ± 100% ç©©å®š

### âš¡ æ•ˆèƒ½ç›®æ¨™
- [ ] é é¢è¼‰å…¥æ™‚é–“ < 2 ç§’
- [ ] API å›æ‡‰æ™‚é–“ < 500ms
- [ ] è³‡æ–™åº«æŸ¥è©¢æœ€ä½³åŒ– > 90%
- [ ] å‰ç«¯ bundle å¤§å° < 2MB

### ğŸ”’ å®‰å…¨ç›®æ¨™  
- [x] RLS æ”¿ç­– 100% è¦†è“‹
- [ ] SQL Injection é˜²è­· 100%
- [ ] ç”¨æˆ¶è¼¸å…¥é©—è­‰ 100%
- [ ] å­˜å–æ—¥èªŒå®Œæ•´æ€§ 100%

---

**ğŸ¯ å°ˆæ¡ˆç›®æ¨™**: å»ºç«‹å®Œæ•´ã€å®‰å…¨ã€é«˜æ•ˆçš„å°å­¸ LMS ç³»çµ±ï¼Œæ”¯æ´ ELA ä¸‰è»Œæ•™å­¸æ¶æ§‹èˆ‡æ™ºèƒ½åˆ†æåŠŸèƒ½ã€‚

**ğŸ“ æŠ€è¡“æ”¯æ´**: åƒè€ƒ `CLAUDE.md` ç²å–è©³ç´°æŠ€è¡“è¦ç¯„èˆ‡é–‹ç™¼æŒ‡å—ã€‚