# Database Verification Scripts

é€™å€‹ç›®éŒ„åŒ…å«ç”¨æ–¼é©—è­‰ Courses Architecture Migration (003a & 003b) çš„è…³æœ¬ã€‚

## ğŸ“‹ é©—è­‰è…³æœ¬

### 1. `verify_courses_architecture.sql`
**ç”¨é€”**ï¼šå…¨é¢é©—è­‰ migration æ˜¯å¦æ­£ç¢ºåŸ·è¡Œ

**æª¢æŸ¥é …ç›®**ï¼š
- âœ… ENUM é¡å‹ (user_role, teacher_type, course_type)
- âœ… æ–°è¡¨çµæ§‹ (courses, student_courses)
- âœ… æ–°æ¬„ä½ (scores.course_id)
- âœ… ç´¢å¼•å»ºç«‹
- âœ… è§¸ç™¼å™¨å­˜åœ¨
- âœ… è¦–åœ–å»ºç«‹
- âœ… RLS æ”¿ç­–
- âœ… è³‡æ–™çµ±è¨ˆ

**åŸ·è¡Œæ–¹å¼**ï¼š
```sql
-- åœ¨ Supabase SQL Editor ä¸­åŸ·è¡Œ
\i db/verification/verify_courses_architecture.sql
```

### 2. `test_triggers.sql`
**ç”¨é€”**ï¼šæ¸¬è©¦è‡ªå‹•è§¸ç™¼å™¨åŠŸèƒ½

**æ¸¬è©¦é …ç›®**ï¼š
- âœ… æ–°ç­ç´šè‡ªå‹•å»ºç«‹ 3 å€‹èª²ç¨‹ (LT/IT/KCFS)
- âœ… å­¸ç”Ÿåˆ†é…åˆ°ç­ç´šæ™‚è‡ªå‹•è¨»å†Šæ‰€æœ‰èª²ç¨‹
- âœ… è¦–åœ–æ­£ç¢ºé¡¯ç¤ºè³‡æ–™
- âœ… å¾ŒåŠ å…¥çš„å­¸ç”Ÿä¹Ÿèƒ½è‡ªå‹•è¨»å†Š

**åŸ·è¡Œæ–¹å¼**ï¼š
```sql
-- åœ¨ Supabase SQL Editor ä¸­åŸ·è¡Œ
\i db/verification/test_triggers.sql
```

### 3. `cleanup_test_data.sql`
**ç”¨é€”**ï¼šæ¸…ç†æ¸¬è©¦éç¨‹ä¸­å»ºç«‹çš„æ¸¬è©¦è³‡æ–™

**æ¸…ç†é …ç›®**ï¼š
- ğŸ—‘ï¸ æ¸¬è©¦å­¸ç”Ÿè¨»å†Šè³‡æ–™
- ğŸ—‘ï¸ æ¸¬è©¦èª²ç¨‹
- ğŸ—‘ï¸ æ¸¬è©¦å­¸ç”Ÿ
- ğŸ—‘ï¸ æ¸¬è©¦ç­ç´š

**åŸ·è¡Œæ–¹å¼**ï¼š
```sql
-- åœ¨æ¸¬è©¦å®Œæˆå¾ŒåŸ·è¡Œ
\i db/verification/cleanup_test_data.sql
```

## ğŸ”„ å®Œæ•´é©—è­‰æµç¨‹

### ç¬¬ä¸€éšæ®µï¼šæ¶æ§‹é©—è­‰
1. åŸ·è¡Œ `verify_courses_architecture.sql`
2. æª¢æŸ¥æ‰€æœ‰é …ç›®éƒ½é¡¯ç¤ºæ­£ç¢º
3. ç¢ºèªè³‡æ–™è¡¨çµæ§‹å®Œæ•´

### ç¬¬äºŒéšæ®µï¼šåŠŸèƒ½æ¸¬è©¦
1. åŸ·è¡Œ `test_triggers.sql`
2. é©—è­‰è§¸ç™¼å™¨æ­£å¸¸é‹ä½œ
3. ç¢ºèªè¦–åœ–é¡¯ç¤ºæ­£ç¢ºè³‡æ–™

### ç¬¬ä¸‰éšæ®µï¼šæ¸…ç†
1. åŸ·è¡Œ `cleanup_test_data.sql`
2. ç¢ºä¿æ¸¬è©¦è³‡æ–™å·²æ¸…é™¤
3. è³‡æ–™åº«å›åˆ°ä¹¾æ·¨ç‹€æ…‹

## âœ… é æœŸçµæœ

### æ¶æ§‹é©—è­‰é æœŸçµæœï¼š
- **ENUM é¡å‹**ï¼šuser_role, teacher_type, course_type éƒ½åŒ…å«æ­£ç¢ºå€¼
- **æ–°è¡¨**ï¼šcourses, student_courses å­˜åœ¨ä¸”çµæ§‹æ­£ç¢º
- **ç´¢å¼•**ï¼šæ‰€æœ‰ course ç›¸é—œç´¢å¼•å·²å»ºç«‹
- **è§¸ç™¼å™¨**ï¼šcourse ç›¸é—œè§¸ç™¼å™¨å­˜åœ¨
- **è¦–åœ–**ï¼šcourse_details, student_course_enrollments å¯æ­£å¸¸æŸ¥è©¢

### åŠŸèƒ½æ¸¬è©¦é æœŸçµæœï¼š
- **èª²ç¨‹å»ºç«‹**ï¼šæ–°ç­ç´šè‡ªå‹•å»ºç«‹ 3 å€‹èª²ç¨‹ (LT/IT/KCFS)
- **å­¸ç”Ÿè¨»å†Š**ï¼šæ¯å€‹å­¸ç”Ÿè‡ªå‹•è¨»å†Šåˆ° 3 å€‹èª²ç¨‹
- **è¦–åœ–è³‡æ–™**ï¼šèª²ç¨‹è©³æƒ…å’Œè¨»å†Šè³‡æ–™æ­£ç¢ºé¡¯ç¤º
- **ç¸½è¨»å†Šæ•¸**ï¼š3 å­¸ç”Ÿ Ã— 3 èª²ç¨‹ = 9 å€‹è¨»å†Šè¨˜éŒ„

## ğŸš¨ æ•…éšœæ’é™¤

å¦‚æœé©—è­‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥ï¼š
1. æ˜¯å¦å·²æŒ‰é †åºåŸ·è¡Œ 003a å’Œ 003b migration
2. æ˜¯å¦æœ‰æ¬Šé™åŸ·è¡Œæ‰€æœ‰ SQL æ“ä½œ
3. æª¢æŸ¥ Supabase æ§åˆ¶å°ä¸­çš„éŒ¯èª¤æ—¥èªŒ

## ğŸ“Š æˆåŠŸæŒ‡æ¨™

å…¨éƒ¨é©—è­‰é€šéå¾Œï¼Œç³»çµ±æ‡‰è©²èƒ½æ”¯æ´ï¼š
- âœ… ç¨ç«‹çš„è‹±èªèª²ç¨‹ç®¡ç† (LT/IT/KCFS)
- âœ… å­¸ç”Ÿå¤šèª²ç¨‹è¨»å†Š
- âœ… åŸºæ–¼èª²ç¨‹çš„æˆç¸¾ç®¡ç†
- âœ… èª²ç¨‹æ¬Šé™æ§åˆ¶ (RLS)
- âœ… è‡ªå‹•åŒ–çš„èª²ç¨‹å’Œè¨»å†Šç®¡ç†