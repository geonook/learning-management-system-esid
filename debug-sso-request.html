<!DOCTYPE html>
<html>
<head>
    <title>Debug SSO Authorization Request</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .param { margin: 5px 0; }
        .key { color: blue; font-weight: bold; }
        .value { color: green; }
    </style>
</head>
<body>
    <h1>SSO Authorization Request Debug</h1>
    <p>當前環境：<strong id="current-origin"></strong></p>

    <div class="section">
        <h2>計算的 redirect_uri</h2>
        <div id="redirect-uri" class="value"></div>
    </div>

    <div class="section">
        <h2>完整授權 URL</h2>
        <div id="auth-url" style="word-break: break-all;"></div>
    </div>

    <div class="section">
        <h2>URL 參數解析</h2>
        <div id="params"></div>
    </div>

    <button onclick="testRedirect()" style="padding: 10px 20px; font-size: 16px;">
        測試重定向到 Info Hub
    </button>

    <script>
        // 模擬 getOAuthCallbackUrl() 函式
        function getOAuthCallbackUrl() {
            if (typeof window !== 'undefined') {
                return `${window.location.origin}/api/auth/callback/infohub`
            }
            return 'http://localhost:3000/api/auth/callback/infohub'
        }

        // 顯示當前 origin
        document.getElementById('current-origin').textContent = window.location.origin

        // 計算 redirect_uri
        const redirectUri = getOAuthCallbackUrl()
        document.getElementById('redirect-uri').textContent = redirectUri

        // 建構完整授權 URL（使用 staging 的配置）
        const config = {
            clientId: 'eb88b24e-8392-45c4-b7f7-39f03b6df208',
            authUrl: 'https://next14-landing.zeabur.app/api/oauth/authorize'
        }

        const authParams = new URLSearchParams({
            client_id: config.clientId,
            redirect_uri: redirectUri,
            response_type: 'code',
            code_challenge: 'dummy_challenge_for_testing',
            code_challenge_method: 'S256',
            state: 'dummy_state_for_testing',
            scope: 'openid profile email',
        })

        const authUrl = `${config.authUrl}?${authParams.toString()}`

        // 顯示完整 URL
        document.getElementById('auth-url').innerHTML = `<a href="${authUrl}" target="_blank">${authUrl}</a>`

        // 解析並顯示參數
        const paramsDiv = document.getElementById('params')
        let paramsHtml = ''
        authParams.forEach((value, key) => {
            paramsHtml += `<div class="param"><span class="key">${key}:</span> <span class="value">${value}</span></div>`
        })
        paramsDiv.innerHTML = paramsHtml

        function testRedirect() {
            if (confirm('即將重定向到 Info Hub 授權頁面，確定要繼續嗎？\n\n注意：這只是測試用途，請檢查 Network 標籤中的請求參數')) {
                window.location.href = authUrl
            }
        }
    </script>
</body>
</html>
